"use client";

import { useState } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { LifePyramid, LifePeriod } from "@/lib/numerology";

interface PyramidChartProps {
  pyramid: LifePyramid;
  currentAge?: number;
}

export default function PyramidChart({
  pyramid,
  currentAge = 0,
}: PyramidChartProps) {
  const [selectedPeriod, setSelectedPeriod] = useState<LifePeriod | null>(null);

  const getCurrentPeriod = (): LifePeriod | null => {
    return (
      pyramid.periods.find(
        (period) => currentAge >= period.startAge && currentAge <= period.endAge
      ) || null
    );
  };

  const getPeriodColor = (period: LifePeriod, isSelected: boolean): string => {
    const currentPeriod = getCurrentPeriod();
    const isCurrent = currentPeriod?.period === period.period;

    if (isSelected) {
      return "from-purple-600 to-pink-600 text-white";
    }

    if (isCurrent) {
      return "from-green-500 to-emerald-500 text-white";
    }

    switch (period.period) {
      case 1:
        return "from-blue-400 to-blue-500 text-white";
      case 2:
        return "from-orange-400 to-orange-500 text-white";
      case 3:
        return "from-teal-400 to-teal-500 text-white";
      case 4:
        return "from-indigo-400 to-indigo-500 text-white";
      default:
        return "from-gray-400 to-gray-500 text-white";
    }
  };

  const getPeriodIcon = (period: number): string => {
    switch (period) {
      case 1:
        return "üå±";
      case 2:
        return "üå≥";
      case 3:
        return "üèÜ";
      case 4:
        return "üåü";
      default:
        return "üìç";
    }
  };

  return (
    <div className="space-y-6">
      {/* Ti√™u ƒë·ªÅ */}
      <div className="text-center space-y-2">
        <h2 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
          üî∫ Kim T·ª± Th√°p Cu·ªôc ƒê·ªùi
        </h2>
        <p className="text-muted-foreground">
          Kh√°m ph√° 4 giai ƒëo·∫°n quan tr·ªçng trong h√†nh tr√¨nh cu·ªôc ƒë·ªùi c·ªßa b·∫°n
        </p>
        {currentAge > 0 && (
          <Badge
            variant="outline"
            className="bg-green-50 text-green-700 border-green-300"
          >
            Tu·ªïi hi·ªán t·∫°i: {currentAge}
          </Badge>
        )}
      </div>

      {/* Bi·ªÉu ƒë·ªì kim t·ª± th√°p */}
      <div className="relative">
        <div className="grid grid-cols-1 gap-4">
          {/* Giai ƒëo·∫°n 4 - ƒê·ªânh kim t·ª± th√°p */}
          <div className="flex justify-center">
            <Card
              className={`w-64 cursor-pointer transition-all duration-300 hover:scale-105 bg-gradient-to-r ${getPeriodColor(
                pyramid.periods[3],
                selectedPeriod?.period === 4
              )}`}
              onClick={() =>
                setSelectedPeriod(
                  selectedPeriod?.period === 4 ? null : pyramid.periods[3]
                )
              }
            >
              <CardContent className="p-4 text-center">
                <div className="text-2xl mb-2">{getPeriodIcon(4)}</div>
                <div className="text-lg font-bold">Giai ƒëo·∫°n 4</div>
                <div className="text-sm opacity-90">
                  {pyramid.periods[3].startAge}+ tu·ªïi
                </div>
                <div className="text-xs opacity-80 mt-1">
                  S·ªë chu k·ª≥: {pyramid.periods[3].cycleNumber}
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Giai ƒëo·∫°n 3 */}
          <div className="flex justify-center gap-4">
            <div className="w-24"></div>
            <Card
              className={`w-64 cursor-pointer transition-all duration-300 hover:scale-105 bg-gradient-to-r ${getPeriodColor(
                pyramid.periods[2],
                selectedPeriod?.period === 3
              )}`}
              onClick={() =>
                setSelectedPeriod(
                  selectedPeriod?.period === 3 ? null : pyramid.periods[2]
                )
              }
            >
              <CardContent className="p-4 text-center">
                <div className="text-2xl mb-2">{getPeriodIcon(3)}</div>
                <div className="text-lg font-bold">Giai ƒëo·∫°n 3</div>
                <div className="text-sm opacity-90">
                  {pyramid.periods[2].startAge}-{pyramid.periods[2].endAge} tu·ªïi
                </div>
                <div className="text-xs opacity-80 mt-1">
                  S·ªë chu k·ª≥: {pyramid.periods[2].cycleNumber}
                </div>
              </CardContent>
            </Card>
            <div className="w-24"></div>
          </div>

          {/* Giai ƒëo·∫°n 2 */}
          <div className="flex justify-center gap-4">
            <Card
              className={`w-56 cursor-pointer transition-all duration-300 hover:scale-105 bg-gradient-to-r ${getPeriodColor(
                pyramid.periods[1],
                selectedPeriod?.period === 2
              )}`}
              onClick={() =>
                setSelectedPeriod(
                  selectedPeriod?.period === 2 ? null : pyramid.periods[1]
                )
              }
            >
              <CardContent className="p-4 text-center">
                <div className="text-2xl mb-2">{getPeriodIcon(2)}</div>
                <div className="text-lg font-bold">Giai ƒëo·∫°n 2</div>
                <div className="text-sm opacity-90">
                  {pyramid.periods[1].startAge}-{pyramid.periods[1].endAge} tu·ªïi
                </div>
                <div className="text-xs opacity-80 mt-1">
                  S·ªë chu k·ª≥: {pyramid.periods[1].cycleNumber}
                </div>
              </CardContent>
            </Card>
            <Card
              className={`w-56 cursor-pointer transition-all duration-300 hover:scale-105 bg-gradient-to-r ${getPeriodColor(
                pyramid.periods[1],
                selectedPeriod?.period === 2
              )}`}
              onClick={() =>
                setSelectedPeriod(
                  selectedPeriod?.period === 2 ? null : pyramid.periods[1]
                )
              }
            >
              <CardContent className="p-4 text-center">
                <div className="text-2xl mb-2">{getPeriodIcon(2)}</div>
                <div className="text-lg font-bold">Giai ƒëo·∫°n 2</div>
                <div className="text-sm opacity-90">
                  {pyramid.periods[1].startAge}-{pyramid.periods[1].endAge} tu·ªïi
                </div>
                <div className="text-xs opacity-80 mt-1">
                  S·ªë chu k·ª≥: {pyramid.periods[1].cycleNumber}
                </div>
              </CardContent>
            </Card>
          </div>

          {/* Giai ƒëo·∫°n 1 - ƒê√°y kim t·ª± th√°p */}
          <div className="flex justify-center gap-2">
            <Card
              className={`w-48 cursor-pointer transition-all duration-300 hover:scale-105 bg-gradient-to-r ${getPeriodColor(
                pyramid.periods[0],
                selectedPeriod?.period === 1
              )}`}
              onClick={() =>
                setSelectedPeriod(
                  selectedPeriod?.period === 1 ? null : pyramid.periods[0]
                )
              }
            >
              <CardContent className="p-4 text-center">
                <div className="text-2xl mb-2">{getPeriodIcon(1)}</div>
                <div className="text-lg font-bold">Giai ƒëo·∫°n 1</div>
                <div className="text-sm opacity-90">
                  {pyramid.periods[0].startAge}-{pyramid.periods[0].endAge} tu·ªïi
                </div>
                <div className="text-xs opacity-80 mt-1">
                  S·ªë chu k·ª≥: {pyramid.periods[0].cycleNumber}
                </div>
              </CardContent>
            </Card>
            <Card
              className={`w-48 cursor-pointer transition-all duration-300 hover:scale-105 bg-gradient-to-r ${getPeriodColor(
                pyramid.periods[0],
                selectedPeriod?.period === 1
              )}`}
              onClick={() =>
                setSelectedPeriod(
                  selectedPeriod?.period === 1 ? null : pyramid.periods[0]
                )
              }
            >
              <CardContent className="p-4 text-center">
                <div className="text-2xl mb-2">{getPeriodIcon(1)}</div>
                <div className="text-lg font-bold">Giai ƒëo·∫°n 1</div>
                <div className="text-sm opacity-90">
                  {pyramid.periods[0].startAge}-{pyramid.periods[0].endAge} tu·ªïi
                </div>
                <div className="text-xs opacity-80 mt-1">
                  S·ªë chu k·ª≥: {pyramid.periods[0].cycleNumber}
                </div>
              </CardContent>
            </Card>
            <Card
              className={`w-48 cursor-pointer transition-all duration-300 hover:scale-105 bg-gradient-to-r ${getPeriodColor(
                pyramid.periods[0],
                selectedPeriod?.period === 1
              )}`}
              onClick={() =>
                setSelectedPeriod(
                  selectedPeriod?.period === 1 ? null : pyramid.periods[0]
                )
              }
            >
              <CardContent className="p-4 text-center">
                <div className="text-2xl mb-2">{getPeriodIcon(1)}</div>
                <div className="text-lg font-bold">Giai ƒëo·∫°n 1</div>
                <div className="text-sm opacity-90">
                  {pyramid.periods[0].startAge}-{pyramid.periods[0].endAge} tu·ªïi
                </div>
                <div className="text-xs opacity-80 mt-1">
                  S·ªë chu k·ª≥: {pyramid.periods[0].cycleNumber}
                </div>
              </CardContent>
            </Card>
          </div>
        </div>

        {/* Ch√∫ th√≠ch */}
        <div className="mt-6 text-center text-sm text-muted-foreground">
          <p>Nh·∫•p v√†o t·ª´ng giai ƒëo·∫°n ƒë·ªÉ xem th√¥ng tin chi ti·∫øt</p>
          {currentAge > 0 && (
            <p className="text-green-600 font-medium mt-1">
              üéØ Giai ƒëo·∫°n hi·ªán t·∫°i ƒë∆∞·ª£c ƒë√°nh d·∫•u m√†u xanh
            </p>
          )}
        </div>
      </div>

      {/* Th√¥ng tin chi ti·∫øt giai ƒëo·∫°n ƒë∆∞·ª£c ch·ªçn */}
      {selectedPeriod && (
        <Card className="border-2 border-purple-200 bg-gradient-to-r from-purple-50 to-pink-50">
          <CardHeader>
            <CardTitle className="flex items-center gap-3 text-purple-700">
              <span className="text-2xl">
                {getPeriodIcon(selectedPeriod.period)}
              </span>
              <div>
                <div>
                  Giai ƒëo·∫°n {selectedPeriod.period}:{" "}
                  {selectedPeriod.description}
                </div>
                <div className="text-base font-normal text-purple-600">
                  ƒê·ªô tu·ªïi:{" "}
                  {selectedPeriod.startAge === 0
                    ? "T·ª´ sinh"
                    : selectedPeriod.startAge}
                  -
                  {selectedPeriod.endAge === 100
                    ? "cu·ªëi ƒë·ªùi"
                    : `${selectedPeriod.endAge} tu·ªïi`}{" "}
                  | S·ªë chu k·ª≥: {selectedPeriod.cycleNumber}
                </div>
              </div>
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-6">
            {/* ƒê·∫∑c ƒëi·ªÉm */}
            <div>
              <h4 className="font-semibold text-lg mb-3 text-purple-700 flex items-center gap-2">
                ‚ú® ƒê·∫∑c ƒëi·ªÉm n·ªïi b·∫≠t
              </h4>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                {selectedPeriod.characteristics.map((char, index) => (
                  <Badge
                    key={index}
                    variant="outline"
                    className="p-2 text-sm bg-white border-purple-200"
                  >
                    {char}
                  </Badge>
                ))}
              </div>
            </div>

            {/* C∆° h·ªôi */}
            <div>
              <h4 className="font-semibold text-lg mb-3 text-green-700 flex items-center gap-2">
                üéØ C∆° h·ªôi ph√°t tri·ªÉn
              </h4>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                {selectedPeriod.opportunities.map((opp, index) => (
                  <Badge
                    key={index}
                    variant="outline"
                    className="p-2 text-sm bg-green-50 border-green-200 text-green-700"
                  >
                    {opp}
                  </Badge>
                ))}
              </div>
            </div>

            {/* Th√°ch th·ª©c */}
            <div>
              <h4 className="font-semibold text-lg mb-3 text-orange-700 flex items-center gap-2">
                ‚ö†Ô∏è Th√°ch th·ª©c c·∫ßn v∆∞·ª£t qua
              </h4>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                {selectedPeriod.challenges.map((challenge, index) => (
                  <Badge
                    key={index}
                    variant="outline"
                    className="p-2 text-sm bg-orange-50 border-orange-200 text-orange-700"
                  >
                    {challenge}
                  </Badge>
                ))}
              </div>
            </div>

            <div className="text-center pt-4">
              <Button
                variant="outline"
                onClick={() => setSelectedPeriod(null)}
                className="bg-purple-50 border-purple-200 text-purple-700 hover:bg-purple-100"
              >
                ƒê√≥ng th√¥ng tin chi ti·∫øt
              </Button>
            </div>
          </CardContent>
        </Card>
      )}

      {/* Th√¥ng tin chuy·ªÉn ƒë·ªïi giai ƒëo·∫°n */}
      {pyramid.transitions.length > 0 && (
        <Card className="bg-gradient-to-r from-blue-50 to-cyan-50">
          <CardHeader>
            <CardTitle className="text-blue-700 flex items-center gap-2">
              üîÑ C√°c m·ªëc chuy·ªÉn ƒë·ªïi quan tr·ªçng
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              {pyramid.transitions.map((transition, index) => (
                <div
                  key={index}
                  className="flex items-center gap-4 p-3 bg-white rounded-lg border border-blue-200"
                >
                  <div className="w-12 h-12 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold">
                    {transition.age}
                  </div>
                  <div>
                    <div className="font-medium text-blue-900">
                      Tu·ªïi {transition.age}
                    </div>
                    <div className="text-sm text-blue-700">
                      {transition.description}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
      )}

      {/* H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng */}
      <Card className="bg-gradient-to-r from-amber-50 to-yellow-50">
        <CardHeader>
          <CardTitle className="text-amber-700 flex items-center gap-2">
            üí° C√°ch hi·ªÉu kim t·ª± th√°p cu·ªôc ƒë·ªùi
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-3">
          <p className="text-amber-800">
            <strong>Kim t·ª± th√°p cu·ªôc ƒë·ªùi</strong> chia cu·ªôc ƒë·ªùi th√†nh 4 giai
            ƒëo·∫°n ch√≠nh, m·ªói giai ƒëo·∫°n c√≥ nh·ªØng ƒë·∫∑c ƒëi·ªÉm, c∆° h·ªôi v√† th√°ch th·ª©c
            ri√™ng:
          </p>
          <ul className="space-y-2 text-amber-700">
            <li className="flex items-start gap-2">
              <span>üå±</span>
              <span>
                <strong>Giai ƒëo·∫°n 1:</strong> H√¨nh th√†nh v√† h·ªçc h·ªèi - T·ª´ sinh
                ƒë·∫øn tu·ªïi tr∆∞·ªüng th√†nh
              </span>
            </li>
            <li className="flex items-start gap-2">
              <span>üå≥</span>
              <span>
                <strong>Giai ƒëo·∫°n 2:</strong> Ph√°t tri·ªÉn s·ª± nghi·ªáp - X√¢y d·ª±ng
                n·ªÅn t·∫£ng cu·ªôc s·ªëng
              </span>
            </li>
            <li className="flex items-start gap-2">
              <span>üèÜ</span>
              <span>
                <strong>Giai ƒëo·∫°n 3:</strong> Tr∆∞·ªüng th√†nh v√† ·ªïn ƒë·ªãnh - ƒê·∫°t ƒë∆∞·ª£c
                th√†nh t·ª±u ch√≠nh
              </span>
            </li>
            <li className="flex items-start gap-2">
              <span>üåü</span>
              <span>
                <strong>Giai ƒëo·∫°n 4:</strong> Tr√≠ tu·ªá v√† chia s·∫ª - ƒê·ªÉ l·∫°i di s·∫£n
                cho th·∫ø h·ªá sau
              </span>
            </li>
          </ul>
          <p className="text-amber-800 text-sm mt-4">
            <em>
              L∆∞u √Ω: C√°c tu·ªïi chuy·ªÉn ƒë·ªïi ƒë∆∞·ª£c t√≠nh d·ª±a tr√™n s·ªë ch·ªß ƒë·∫°o c√° nh√¢n
              v√† c√≥ th·ªÉ kh√°c nhau gi·ªØa c√°c c√° nh√¢n.
            </em>
          </p>
        </CardContent>
      </Card>
    </div>
  );
}
